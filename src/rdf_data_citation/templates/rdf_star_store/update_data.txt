# prefixes
{0}

delete {{
    <<?subjectToUpdate ?predicateToUpdate ?objectToUpdate>> citing:valid_until "9999-12-31T00:00:00.000+02:00"^^xsd:dateTime
}}
insert {{
    # outdate old triple with date as of now()
    <<?subjectToUpdate ?predicateToUpdate ?objectToUpdate>> citing:valid_until ?newVersion.
    # update new row with value and timestamp as of now()
    ?subjectToUpdate ?predicateToUpdate ?newValue. # new value
    # assign new version. if variable is used, multiple ?newVersion are retrieved leading to multiple updates. TODO: fix this
    <<?subjectToUpdate ?predicateToUpdate ?newValue>> citing:valid_from ?newVersion ;
                                                      citing:valid_until "9999-12-31T00:00:00.000+02:00"^^xsd:dateTime.
}}
where {{
    # business logic - rows to update as select statement
    {{
        {1}
    }}
    bind({2} as ?newValue). #new Value
    # versioning
    <<?subjectToUpdate ?predicateToUpdate ?objectToUpdate>> citing:valid_until ?valid_until .
    BIND(xsd:dateTime(NOW()) AS ?newVersion).
    filter(?valid_until = "9999-12-31T00:00:00.000+02:00"^^xsd:dateTime)
    filter(?newValue != ?objectToUpdate) # nothing should be changed if old and new value are the same
}}